<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Octoprint en OpenWRT (tp-link 1043nd) | DocumentarI/O</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="http://dvinazza.github.io/posts/octoprint-en-openwrt-tp-link-1043nd.html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta name="author" content="David Vinazza">
<meta property="og:site_name" content="DocumentarI/O">
<meta property="og:title" content="Octoprint en OpenWRT (tp-link 1043nd)">
<meta property="og:url" content="http://dvinazza.github.io/posts/octoprint-en-openwrt-tp-link-1043nd.html">
<meta property="og:description" content="Hace un par de años Leí la nota de Matt Defenthaler donde cuenta que se encontró un router tirado en la calle y lo resucitó en forma de servidor de impresiones 3d. Como la impresora 3d que armamos no ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-22T23:05:27-03:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Mostrar navegación</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://dvinazza.github.io/">

                <span id="blog-title">DocumentarI/O</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../archive.html">Archivo</a>
                </li>
<li>
<a href="../categories/index.html">Tags</a>
                </li>
<li>
<a href="../rss.xml">feed RSS</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">Otros Sitios<b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="https://github.com/dvinazza/">github</a>
                    </li>
<li>
<a href="http://about.me/david.vinazza">about.me</a>
                    </li>
<li>
<a href="http://ar.linkedin.com/in/davidvinazza/">linked.in</a>
            </li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="octoprint-en-openwrt-tp-link-1043nd.rst" id="sourcelink">Código fuente</a>
    </li>
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Octoprint en OpenWRT (tp-link 1043nd)</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    David Vinazza
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2017-05-22T23:05:27-03:00" itemprop="datePublished" title="2017-05-22 23:05">2017-05-22 23:05</time></a></p>
                <p class="commentline">        </p>
<div class="g-commentcount" data-href="/posts/octoprint-en-openwrt-tp-link-1043nd.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script><p class="sourceline"><a href="octoprint-en-openwrt-tp-link-1043nd.rst" id="sourcelink">Código fuente</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>Hace un par de años Leí la <a class="reference external" href="http://csmatt.com/notes/?p=154">nota de Matt Defenthaler</a> donde cuenta que se encontró un router tirado en la calle y lo resucitó en forma de servidor de impresiones 3d. Como la impresora 3d que armamos no tiene display (ni tarjeta usb), la venía usando conectada a un raspberry pi, corriendo repetier server.</p>
<p>Si, lo sé, es un overkill, pero hasta hace poco no dispuse del tiempo y las ganas[1]_ para resolverlo.</p>
<div class="section" id="openwrt-en-tp-link-1043nd-v2-0">
<h2>OpenWRT en TP-Link 1043nd (v2.0)</h2>
<p>La maravilla del router tp-link es que trae un puerto usb. El mismo se puede utilizar para albergar una carpeta compartida, o compartir una impresora (tradicional, de esas que escriben en papel) en la red local. Para conectarle una impresora 3d en cambio hace falta cambiar su sistema operativo.</p>
<p>Si bien hay varios SO para reemplazar el que traen de fabrica los routers, el tutorial original que encontré utiliza OpenWRT así que fui por ahí. En teoría se podría usar tanto Tomato como DD-WRT mediante Optware.</p>
<div class="section" id="flasheo">
<h3>Flasheo</h3>
<p>Bastante sencillo pero está fuera de alcance de este post. Hay cientos de tutoriales y por lo general son bastante claros aunque a veces pequen de simplistas y poco descriptivos. Personalmente no tuve problemas al seguir (la pobre) documentación que encontré en <a class="reference external" href="https://wiki.openwrt.org/toh/tp-link/tl-wr1043nd">la página dedicada al wr1043nd de openwrt</a>.
<a class="reference external" href="https://wiki.openwrt.org/toh/tp-link/tl-wr1043nd">https://wiki.openwrt.org/toh/tp-link/tl-wr1043nd</a></p>
</div>
<div class="section" id="configuracion-pendrive-como-almacenamiento">
<h3>Configuración pendrive como almacenamiento</h3>
<p>Una vez que está instalado OpenWRT, lo siguiente es disponer de lugar para instalar nuestras porquerías (cerca de 250mb, que para la memoria de un router es muchísimo).</p>
<p>Vamos a usar un pendrive cualunque, lo recomendable es formatearlo de antemano (no en el router) para hacer más rápido. De yapa podemos armar una partición de swap y rezar un poco para no precisarla jamás.</p>
<p>overlayfs y swap</p>
<p><a class="reference external" href="https://wiki.openwrt.org/doc/howto/extroot">https://wiki.openwrt.org/doc/howto/extroot</a></p>
</div>
<div class="section" id="configuracion-puerto-serie">
<h3>Configuración puerto Serie</h3>
<p>Lo siguiente es instalar el driver del puerto serie y el del arduino.</p>
<pre class="code bash"><a name="rest_code_6f57673a30094aca8ab6d187fb9d1501-1"></a>opkg install kmod-usb-acm kmod-usb-serial-ch341  <span class="c1"># Driver para el Arduino</span>
</pre>
</div>
<div class="section" id="ssl">
<h3>SSL</h3>
<p>Al instalar los paquetes de python vamos a conectarnos a sitios HTTPS así vamos a precisar instalar los certificados. Quizá exista alguna manera de evitar que pip compruebe las identidades, pero de nuevo, la intersección tiempo y ganas me resulta casi inexistente.</p>
<p><a class="reference external" href="https://wiki.openwrt.org/doc/howto/wget-ssl-certs">https://wiki.openwrt.org/doc/howto/wget-ssl-certs</a></p>
<pre class="code bash"><a name="rest_code_55c1c03ff29c48b78b21499f10ea14ee-1"></a>opkg install ca-certificates
</pre>
<p>Esto lo hice pero no estoy seguro de que sea necesario.</p>
<pre class="code bash"><a name="rest_code_cdc6bbaad60c4a7db892ef34570b7ab2-1"></a>opkg update
<a name="rest_code_cdc6bbaad60c4a7db892ef34570b7ab2-2"></a>opkg install wget
<a name="rest_code_cdc6bbaad60c4a7db892ef34570b7ab2-3"></a>mkdir -p /etc/ssl/certs
<a name="rest_code_cdc6bbaad60c4a7db892ef34570b7ab2-4"></a><span class="nb">echo</span> <span class="s2">"export SSL_CERT_DIR=/etc/ssl/certs"</span> &gt;&gt; /etc/profile
<a name="rest_code_cdc6bbaad60c4a7db892ef34570b7ab2-5"></a><span class="nb">source</span> /etc/profile
</pre>
</div>
</div>
<div class="section" id="octoprint">
<h2>Octoprint</h2>
<p>Lamentablemente no pude instalar la versión más reciente. Aparentemente en algún momento requiere compilar código y en el OpenWRT no hay con que, ni me interesa configurar un ambiente para hacer cross-compiling. Quizá más adelante pueda ser un desafío, ahora mismo quiero terminar esto y dormir como cualquier ser humano.</p>
<p>Así que agarré la versión que puso el tipo acá: <a class="reference external" href="https://docs.google.com/file/d/0B6-A_C5DmUPxZFhtMnlVaWdsOWc">https://docs.google.com/file/d/0B6-A_C5DmUPxZFhtMnlVaWdsOWc</a></p>
<p>También la subi yo por si se cae: <a class="reference external" href="https://www.dropbox.com/s/vcwxxzgpwq3t9es/octoprint.zip?dl=0">https://www.dropbox.com/s/vcwxxzgpwq3t9es/octoprint.zip?dl=0</a></p>
<div class="section" id="environment">
<h3>Environment</h3>
<p>Esto hay que comprobar que funcione realmente. En teoría entrás al environment e instalás todo, pero cuando lo desactivas sigue todo ahí. Super desprolijo... voy a tener pesadillas.</p>
<pre class="code bash"><a name="rest_code_c7749bdcfd03444693a2dbb8fe66d358-1"></a>opkg install python python-setuptools
</pre>
<p>Mi router tiene aproximadamente 30mb para archivos temporales en /tmp, que es donde el pip descarga y extrae los paquetes de python. Como lo hace uno por uno, para la mayoría de los paquetes va a funcionar pero hubo uno o dos que daban problema así que directamente armé otro directorio temporal.</p>
<pre class="code bash"><a name="rest_code_53f452ced2ee43fd99aac14093d56518-1"></a>mkdir ~/tmp
<a name="rest_code_53f452ced2ee43fd99aac14093d56518-2"></a><span class="nv">TMPDIR</span><span class="o">=</span>~/tmp pip install -r octoprint_requirements.txt  <span class="c1"># Cambio el dir de los temporales</span>
</pre>
</div>
</div>
<div class="section" id="conclusiones">
<h2>Conclusiones</h2>
<p>Velocidad en general. Estabilidad. Ruido en la alimentación?</p>
<table class="docutils footnote" frame="void" id="id1" rules="none">
<colgroup>
<col class="label">
<col>
</colgroup>
<tbody valign="top"><tr>
<td class="label">[1]</td>
<td>Aunque la vida adulta parece ser justamente la extinción de la intersección entre ambas.</td>
</tr></tbody>
</table>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="migrador-de-dbs-postgresql.html" rel="prev" title="Migrador de DBs (PostgreSQL)">Publicación anterior</a>
            </li>
            <li class="next">
                <a href="network-manager-script.html" rel="next" title="Synergy mediante un script de Network Manager">Siguiente publicación</a>
            </li>
        </ul></nav></aside><section class="comments"><h2>Comentarios</h2>
                <script src="https://apis.google.com/js/plusone.js"></script><div class="g-comments" data-href="http://dvinazza.github.io/posts/octoprint-en-openwrt-tp-link-1043nd.html" data-first_party_property="BLOGGER" data-view_type="FILTERED_POSTMOD">
</div>


        </section></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:davidvinazza@gmail.com">David Vinazza</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

            <script src="../assets/js/all-nocdn.js"></script><script src="../assets/js/colorbox-i18n/jquery.colorbox-es.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("es");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
